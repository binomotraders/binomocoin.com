
var bncTransferObj = "";
$.ajaxSetup({
    headers: {
        "X-CSRF-TOKEN": $('meta[name="csrf-token"]').attr("content"),
    },
});

$("#formConfirmSendBNC").submit(function (e) {
    e.preventDefault();
    if ($(this).valid()) {
        $(this).find("button[type=submit]").prop("disabled", true);

        const noBNCToSend = $("#noBNCToSend").val();
        fetchCurrentBncValue(noBNCToSend);        
    } else {
        $(this).find("button[type=submit]").prop("disabled", false);
    }
});

const fetchCurrentBncValue = (noBNCToSend) => {
    $.ajax({
        url: "/transfer/getbncvalue/" + noBNCToSend,
        type: "GET",
        contentType: "application/json",
        success: function (result) {
            if (result.status === "success") {
                bncTransferObj = result.bncTransferObj;
                let payAmount = result.payAmount;
                payAmount = new Intl.NumberFormat("en-IN").format(payAmount);

                $("#lblInrRecAmount").html(payAmount);
                $("#lblBNCtoSend").html(noBNCToSend); 

                $("#confirmTransferModal").modal({
                    backdrop: "static",
                    datakeyboard: false,
                    show: true,
                });               
            } else {
                alert("505 | Fetch BNC value error, Please contact admin...!");
            }
        },
    });
    return;
};

$("#btnSendBNC").click(function () {
    $("#noBNCToSend").val(bncTransferObj.transfered_coin);
    $("#price_per_coin").val(bncTransferObj.price_per_coin);
    $("#total_price").val(bncTransferObj.total_price);
    
    formConfirmSendBNC.submit();
});

const formConfirmSendBNC = document.getElementById("formConfirmSendBNC");